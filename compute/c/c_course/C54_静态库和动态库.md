# 静态库和动态库

[TOC]



具有如下文件

minus.c

```c
float minus(float a,float b){
	
}
```

add.c

```c
float add(float a, float b)
{
    return a + b;
}
```

pow.c

```c
float pow(float a, int b)
{
    float rt = a;
    for (int i = 1; i <= b; i++)
    {
        rt *= i;
    }
    return a - b;
}
```

## 静态库

静态链接：将多个目标二进制文件拷贝到一个可执行文件的链接方式为静态链接；

命令行输入

```shell
$ gcc -c add.c minus.c pow.c
#生成  add.o minus.o pow.o
```

执行ar打包工具，将 add.o minus.o pow.o 文件全部静态链接到  libcalc.a

```shell
$ ar rs libcalc.a add.o minus.o pow.o 
C:\_PRO\DEV\mingw64\bin\ar.exe: creating libcalc.a
```

### 静态链接

```shell
$ gcc app1.c -L. -lcalc -o app1.exe
#   L 指定生成位置
#   -l 指定静态库名称  不带空格
```

 

## 动态库

动态链接：用于热更新 ，替换部分组件时常用，苹果由于禁止动态库更新保证安全性；

首先生成位置无关的文件 add.o minus.o pow.o

```shell
$ gcc -fPIC -c add.c minus.c pow.c
#-fPIC 位置无关  position independent code   
```

打包为动态库

```shell
$ gcc -shared add.o minus.o pow.o -o libcalc.dll 
```

上述动作全自动为

```shell
$ gcc -shared  -fPIC  add.c minus.c pow.c -o libcalc.dll 
```

### 链接动态库

直接关联

```shell
$ gcc app1.c libcalc.dll -o app3.exe
```

指定路径关联

```shell
$ gcc app1.c -L. -lcalc -o app3.exe
```

























